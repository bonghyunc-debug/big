# 2024 본표-부표 합산 및 공제 로직 테스트 시나리오

본 문서는 자동화 테스트 구현 시 참조할 수 있는 데이터 시나리오를 정의한다.

## 시나리오 1: 부동산 2건 + 가상자산 1건 합산
- **입력**
  - `real_estate` 자산 A: 양도가액 300,000,000원, 취득가액 180,000,000원, 자본적지출 10,000,000원, 필요경비 5,000,000원, 공제율 0.32.
  - `real_estate` 자산 B: 양도가액 220,000,000원, 취득가액 120,000,000원, 자본적지출 5,000,000원, 필요경비 4,000,000원, 공제율 0.24.
  - `virtual_assets` 자산 C: 수량 1.5, 취득단가 20,000,000원, 양도단가 24,000,000원, 수수료 100,000원.
- **기대 결과**
  - 부표 합계: `real_estate.totalGain` = (300M-180M-10M-5M)×(1-0.32) + (220M-120M-5M-4M)×(1-0.24) = 136,600,000원.
  - `virtual_assets.totalGain` = (24M-20M)×1.5 - 100,000 = 5,900,000원.
  - 본표 `aggregateNetGain` = 142,500,000원, `aggregateTransferAmount` = 300M+220M+36M = 556,000,000원.
  - 기본공제 2,500,000원 1회 차감 후 `taxableBase` = 140,000,000원.

## 시나리오 2: 금융자산 다건 합산 및 기본공제 단일 적용
- **입력**
  - `financial_assets` 자산 D: 수량 100주, 취득단가 50,000원, 양도단가 65,000원, 수수료 30,000원.
  - `financial_assets` 자산 E: 수량 50주, 취득단가 80,000원, 양도단가 72,000원, 수수료 20,000원.
- **기대 결과**
  - 자산 D 차익 = (65,000-50,000)×100 - 30,000 = 1,470,000원.
  - 자산 E 손익 = (72,000-80,000)×50 - 20,000 = -420,000원.
  - `financial_assets.totalGain` = 1,050,000원 (다건 합산).
  - 본표 `aggregateNetGain` = 1,050,000원, 기본공제 2,500,000원 적용 시 `taxableBase` = 0원으로 하한 보정.

## 시나리오 3: 장기보유특별공제 한도 검증
- **입력**
  - `real_estate` 자산 F: 보유기간 10년, 양도차익 계산 전 금액 100,000,000원, 공제율 요청 0.9.
  - `financial_assets` 자산 G: 보유기간 8년, 양도차익 계산 전 금액 10,000,000원, 공제율 요청 0.35.
- **기대 결과**
  - `longTermDeductionRate`는 각각 스케줄 제한에 따라 0.8(부동산), 0.3(금융자산)으로 캡핑.
  - 수정된 공제율로 계산된 `gain`이 본표 합계에 반영되고, 본표 `longTermDeductionApplied` = true.

## 시나리오 4: 부표 합계-본표 일치 검증
- **입력**: 모든 스케줄의 `totalTransferAmount`, `totalAcquisitionAmount`, `totalExpenses`를 수정 테스트 후 본표 필드 미반영.
- **기대 결과**: 본표 `aggregateTransferAmount`, `aggregateAcquisitionAmount`, `aggregateExpenses`가 각각 부표 합계와 불일치 시 `equals` validator 에러를 발생.

## 시나리오 5: 신고연도/거주자 필수 검증
- **입력**: `filingYear` 누락 또는 `residentType` 미선택 상태로 저장 시도.
- **기대 결과**: 필수 필드 오류 발생, 추가적인 부표 검증은 실행되지 않음.
