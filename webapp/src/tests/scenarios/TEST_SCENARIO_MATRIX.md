# 양도소득세 테스트 시나리오 매트릭스

## 홈택스 정기신고 일반신고 기준 시나리오 분류

### 1. 부동산 - 주택 (Housing)

| ID | 시나리오 | 세율 | 장특공 | 비과세 | 감면 | 구현 |
|----|----------|------|--------|--------|------|------|
| H-001 | 1세대1주택 2년 보유/2년 거주, 9억 이하 | - | - | 전액 | - | ⚠️ |
| H-002 | 1세대1주택 2년 보유/2년 거주, 15억 (고가) | 기본 | 80% | 12억 한도 | - | ⚠️ |
| H-003 | 1세대1주택 10년 보유/10년 거주, 20억 (고가) | 기본 | 80% | 12억 한도 | - | ⚠️ |
| H-004 | 일시적 2주택 (신규 취득 후 3년 내 종전주택 양도) | 기본 | 80% | 전액 | - | ❌ |
| H-005 | 상속주택 + 일반주택 (상속주택 5년 내 양도) | 기본 | 표1 | - | - | ⚠️ |
| H-006 | 혼인합가 2주택 (5년 내 양도) | 기본 | 80% | 전액 | - | ❌ |
| H-007 | 조정대상지역 2주택 (한시배제 기간) | 기본 | 표1 | - | - | ✅ |
| H-008 | 조정대상지역 3주택 (한시배제 기간) | 기본 | 배제 | - | - | ✅ |
| H-009 | 조정대상지역 2주택 (한시배제 종료 후) | +20%p | 배제 | - | - | ⚠️ |
| H-010 | 조정대상지역 3주택 (한시배제 종료 후) | +30%p | 배제 | - | - | ⚠️ |
| H-011 | 주택 1년 미만 양도 | 70% | 배제 | - | - | ✅ |
| H-012 | 주택 1-2년 양도 | 60% | 배제 | - | - | ✅ |
| H-013 | 미등기 주택 양도 | 70% | 배제 | - | - | ✅ |
| H-014 | 해외이주 비과세 (출국 2년 내 양도) | - | - | 전액 | - | ❌ |
| H-015 | 동거봉양 합가 (10년 내 양도) | 기본 | 80% | 전액 | - | ❌ |

### 2. 부동산 - 토지 (Land)

| ID | 시나리오 | 세율 | 장특공 | 비과세 | 감면 | 구현 |
|----|----------|------|--------|--------|------|------|
| L-001 | 일반토지 3년 이상 보유 | 기본 | 표1 | - | - | ✅ |
| L-002 | 일반토지 1년 미만 양도 | 50% | 배제 | - | - | ✅ |
| L-003 | 일반토지 1-2년 양도 | 40% | 배제 | - | - | ✅ |
| L-004 | 비사업용토지 (기본세율+10%p) | +10%p | 표1 | - | - | ✅ |
| L-005 | 자경농지 8년 이상 | 기본 | 표1 | - | 100% | ✅ |
| L-006 | 자경농지 8년 미만 | 기본 | 표1 | - | - | ✅ |
| L-007 | 농지대토 (대체취득) | 기본 | 표1 | - | 100% | ⚠️ |
| L-008 | 공익사업 현금수용 | 기본 | 표1 | - | 10% | ✅ |
| L-009 | 공익사업 채권수용 3년 | 기본 | 표1 | - | 30% | ✅ |
| L-010 | 공익사업 채권수용 5년 | 기본 | 표1 | - | 40% | ✅ |
| L-011 | 임야 (산림지) | 기본 | 표1 | - | 100% | ⚠️ |

### 3. 부동산 - 분양권/입주권 (Presale Rights)

| ID | 시나리오 | 세율 | 장특공 | 비과세 | 감면 | 구현 |
|----|----------|------|--------|--------|------|------|
| P-001 | 분양권 1년 미만 양도 | 70% | 배제 | - | - | ✅ |
| P-002 | 분양권 1-2년 양도 | 60% | 배제 | - | - | ✅ |
| P-003 | 분양권 2년 이상 양도 | 60% | 배제 | - | - | ✅ |
| P-004 | 조합원입주권 1년 미만 | 70% | 배제 | - | - | ✅ |
| P-005 | 조합원입주권 2년 이상 | 기본 | 표1 | - | - | ✅ |
| P-006 | 1세대1주택 중 분양권 취득 후 종전주택 양도 | - | - | 특례 | - | ❌ |

### 4. 상속/증여 취득 (Inheritance/Gift)

| ID | 시나리오 | 세율 | 장특공 | 비과세 | 감면 | 구현 |
|----|----------|------|--------|--------|------|------|
| I-001 | 상속주택 동일세대 (보유기간 통산) | 기본 | 통산 | 가능 | - | ✅ |
| I-002 | 상속주택 별도세대 (본인 보유기간만) | 기본 | 본인 | - | - | ✅ |
| I-003 | 상속토지 (취득가액=상속세평가액) | 기본 | 표1 | - | - | ✅ |
| I-004 | 증여재산 이월과세 5년 내 | 증여자기준 | 증여자기준 | - | - | ✅ |
| I-005 | 증여재산 이월과세 10년 내 (2023년 이후) | 증여자기준 | 증여자기준 | - | - | ✅ |
| I-006 | 증여재산 이월과세 배제 (1세대1주택) | 본인기준 | 본인기준 | 가능 | - | ✅ |
| I-007 | 부담부증여 (채무인수) | 혼합 | 안분 | - | - | ⚠️ |
| I-008 | 가업상속공제 대상 | 기본 | 표1 | - | 특례 | ❌ |

### 5. 주식 (Stock)

| ID | 시나리오 | 세율 | 장특공 | 비과세 | 감면 | 구현 |
|----|----------|------|--------|--------|------|------|
| S-001 | 비상장주식 중소기업 | 10% | - | - | - | ✅ |
| S-002 | 비상장주식 대기업 | 20% | - | - | - | ✅ |
| S-003 | 상장주식 대주주 | 20%/25% | - | - | - | ✅ |
| S-004 | 상장주식 소액주주 | 비과세 | - | 전액 | - | ⚠️ |
| S-005 | 부동산과다법인주식 | 기본+10% | - | - | - | ✅ |
| S-006 | 특정주식 (소득세법 94조) | 기본 | - | - | - | ✅ |
| S-007 | 국외주식 | 22% | - | - | - | ⚠️ |
| S-008 | 벤처기업주식 (3년 보유) | 10% | - | - | 100% | ⚠️ |
| S-009 | 주식 이월과세 (1년 내 양도) | 증여자기준 | - | - | - | ⚠️ |

### 6. 파생상품 (Derivatives)

| ID | 시나리오 | 세율 | 장특공 | 비과세 | 감면 | 구현 |
|----|----------|------|--------|--------|------|------|
| D-001 | KOSPI200 선물/옵션 (2018.4.1 이후) | 10% | - | - | - | ✅ |
| D-002 | KOSPI200 선물/옵션 (2018.3.31 이전) | 5% | - | - | - | ✅ |
| D-003 | 개별주식옵션 | 10% | - | - | - | ✅ |
| D-004 | 해외파생상품 | 10% | - | - | - | ⚠️ |
| D-005 | 파생상품 손실 이월공제 | - | - | - | 손실통산 | ❌ |

### 7. 가산세/수정신고 (Penalties)

| ID | 시나리오 | 무신고 | 과소신고 | 납부지연 | 감면 | 구현 |
|----|----------|--------|----------|----------|------|------|
| PEN-001 | 무신고 (일반) | 20% | - | - | - | ✅ |
| PEN-002 | 무신고 (부정) | 40% | - | - | - | ⚠️ |
| PEN-003 | 과소신고 (일반) | - | 10% | - | - | ✅ |
| PEN-004 | 과소신고 (부정) | - | 40% | - | - | ⚠️ |
| PEN-005 | 기한후신고 1개월 내 | 20% | - | - | 50% | ✅ |
| PEN-006 | 기한후신고 3개월 내 | 20% | - | - | 30% | ✅ |
| PEN-007 | 기한후신고 6개월 내 | 20% | - | - | 20% | ✅ |
| PEN-008 | 납부지연이자 | - | - | 0.022%/일 | - | ⚠️ |

---

## 우선순위별 구현 필요 시나리오

### P0 - 즉시 구현 (홈택스 필수)
- [ ] H-002, H-003: 고가주택 12억 안분 정확한 테스트
- [ ] H-004: 일시적 2주택 특례
- [ ] S-004: 상장주식 소액주주 비과세
- [ ] PEN-008: 납부지연이자 계산

### P1 - 단기 구현 (1주일 내)
- [ ] H-006: 혼인합가 2주택
- [ ] H-009, H-010: 한시배제 종료 후 다주택 중과
- [ ] I-007: 부담부증여 안분 계산
- [ ] D-005: 파생상품 손실 이월공제

### P2 - 중기 구현 (2주일 내)
- [ ] H-014: 해외이주 비과세
- [ ] H-015: 동거봉양 합가
- [ ] P-006: 분양권+종전주택 특례
- [ ] S-007: 국외주식 세율
- [ ] S-009: 주식 이월과세

### P3 - 장기 구현 (1개월 내)
- [ ] I-008: 가업상속공제
- [ ] S-008: 벤처기업주식 감면
- [ ] D-004: 해외파생상품
- [ ] PEN-002, PEN-004: 부정 가산세

---

## 테스트 데이터 템플릿

각 시나리오별 테스트 데이터 구조:

```typescript
interface TestScenario {
  id: string;                    // 시나리오 ID (예: H-002)
  name: string;                  // 시나리오명
  description: string;           // 상세 설명
  legalBasis: string[];          // 법적 근거 (예: ['소득세법 제89조', '시행령 제154조'])

  // 입력 데이터
  input: {
    taxpayer: Taxpayer;
    assets: (BP1Asset | BP2Asset)[];
    reliefs?: Relief[];
    penaltyInfo?: PenaltyInfo;
  };

  // 예상 결과
  expected: {
    transferGain: number;        // 양도차익
    taxableGain: number;         // 과세대상양도차익
    ltDeductionRate: number;     // 장특공율 (%)
    ltDeductionAmount: number;   // 장특공액
    gainIncome: number;          // 양도소득금액
    basicDeduction: number;      // 기본공제
    taxBase: number;             // 과세표준
    calculatedTax: number;       // 산출세액
    reliefAmount: number;        // 감면세액
    finalTax: number;            // 납부할 세액
    ruralSpecialTax: number;     // 농어촌특별세
  };

  // 검증 포인트
  assertions: {
    field: string;
    expected: number | string | boolean;
    tolerance?: number;          // 허용 오차 (원 단위)
  }[];
}
```

---

## 시나리오 작성 프로세스

1. **홈택스 실제 신고 화면 기반 분석**
   - 신고유형 선택 → 자산유형 선택 → 입력항목 확인
   - 각 단계별 필수/선택 입력 항목 정리

2. **법령 검증**
   - 소득세법 제94조~제118조
   - 시행령 제154조~제176조
   - 조세특례제한법 제69조~제77조, 제133조

3. **Edge Case 도출**
   - 경계값 (12억, 2년, 3년 등)
   - 복합 케이스 (상속+다주택, 증여+비과세 등)
   - 시점 기준 (법 개정일, 한시배제 기간 등)

4. **테스트 데이터 생성**
   - 실제 금액 기준 (억 단위)
   - 실제 날짜 기준 (2024년 귀속)
   - 실제 주소 기준 (조정대상지역)

5. **결과 검증**
   - 홈택스 시뮬레이션과 비교
   - 세무사 검토 권장
